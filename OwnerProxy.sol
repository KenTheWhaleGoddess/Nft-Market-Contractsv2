//*~~~> SPDX-License-Identifier: MIT OR Apache-2.0
/*~~~>
    Thank you Phunks, your inspiration and phriendship meant the world to me and helped me through hard times.
      Never stop phighting, never surrender, always stand up for what is right and make the best of all situations towards all people.
      Phunks are phreedom phighters!
        "When the power of love overcomes the love of power the world will know peace." - Jimi Hendrix <3

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(((((((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(((((((((((((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((((((((((((((((((((((@@@@@##############################%%%%%@@@@@((((((((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((((((((((((((((((((((@@@@@##############################%%%%%@@@@@((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((@@@@@########################################%%%%%@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((@@@@@########################################%%%%%@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@###############@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@###############@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((@@@@@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@##########@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((@@@@@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@##########@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@/////////////////////////////////////////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@/////////////////////////////////////////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@#PHUNKYJON///////////////#PHUNKYJON//////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@#PHUNKYJON///////////////#PHUNKYJON//////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@/////@EYES////////////////////@EYES///////////////@@@@@((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@/////@EYES////////////////////@EYES///////////////EAR@@((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@//////////////////////////////////////////////////EAR@@((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@//////////////////////////////////////////////////EAR@@((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@/////////////////////////////////////////////@@@@@@@@@@((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@/////////////////////////////////////////////@@@@@@@@@@((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@//////////NOSE@NOSE@////////////////////#####@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@//////////NOSE@NOSE@////////////////////#####@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((@@@@@#####//////////////////////////////##########@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((@@@@@#####//////////////////////////////##########@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((@SPLIFF@SPLIFF@SPLIFF@SPLIFF@@###################################@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((@SPLIFF@SPLIFF@SPLIFF@SPLIFF@@###################################@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((EMBER(((((,,,,,,,,,,,,,,,,,,,,,,,,,@@@@@MOUTH&&&&&####################@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((EMBER(((((,,,,,,,,,,,,,,,,,,,,,,,,,@@@@@MOUTH&&&&&####################@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((@SPLIFF@SPLIFF@SPLIFF@SPLIFF@@##############################/////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((@SPLIFF@SPLIFF@SPLIFF@SPLIFF@@##############################/////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((((((((((((((((((((((@@@@@##############################//////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((((((((((((((((((((((@@@@@##############################//////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@///////////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@///////////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((@@@@@///////////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((@@@@@///////////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@///////////////@@@@@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@///////////////@@@@@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

 <~~~*/
pragma solidity  >=0.8.0 <0.9.0;

import "@openzeppelin/contracts/security/ReentrancyGuard.sol";

///@notice
/*~~~>
Interface declarations for upgradable contracts accessibility
<~~~*/
interface Marketplace {
  function setControlAdd(address _contAdd) external;
  function setCollAdd(address _coll) external;
  function setBidAdd(address _bid) external;
  function setOffersAdd(address _offer) external;
  function setTradesAdd(address _trade) external;
  function setMarketMintAdd(address _treas) external;
  function setRwdsAdd(address _rwds) external;
  function setMrktNFTAdd(address _mrktNft) external;
  function setRoleAdd(address _role) external;
  function setFee(uint _fee) external;
}
interface NFT {
  function grantRole(bytes32 role, address account) external;
  function revokeRole(bytes32 role, address account) external;
}
interface Offers {
  function setControlAdd(address _contAdd) external;
  function setMrktAdd(address _newAdd) external;
  function setMrktNFTAdd(address _mrktNft) external;
  function setMarketMintAdd(address _newAdd) external;
  function setRwdsAdd(address _rwdsAdd) external;
  function setRoleAdd(address _role) external;
  function setCollAdd(address _coll) external;
  function setBidAdd(address _bid) external;
  function setTradesAdd(address _trade) external;
  function setFee(uint _fee) external;
}
interface Collections {
  function setControlAdd(address _contAdd) external;
  function setRoleAdd(address _role) external;
  function restrictMarketCollection(string[] calldata name, address[] calldata nftContract) external;
  function editMarketCollection(bool[] calldata isNotTradable, string[] calldata name,address[] calldata nftContract, uint[] calldata collectionId) external;
}
interface Trades {
  function setControlAdd(address _contAdd) external;
  function setMrktAdd(address _newAdd) external;
  function setMarketMintAdd(address _newAdd) external;
  function setCollAdd(address _coll) external;
  function setRoleAdd(address _role) external;
  function setOffersAdd(address _offer) external;
  function setBidAdd(address _bid) external;
  function setTradesAdd(address _trade) external;
}
interface Bids {
  function setControlAdd(address _contAdd) external;
  function setMrktAdd(address _mktAdd) external;
  function setMarketMintAdd(address _mintAdd) external;
  function setRwdsAdd(address _rwds) external;
  function setMrktNFTAdd(address _mrktNft) external;
  function setRoleAdd(address _role) external;
  function setOffersAdd(address _offer) external;
  function setCollAdd(address _coll) external;
  function setBidAdd(address _bid) external;
  function setTradesAdd(address _trade) external;
  function setFee(uint _fee) external;
}
interface NFTFactory {
  function setControlAdd(address _contAdd) external;
  function setRoleAdd(address _role) external;
}
interface MarketMint {
  function setControlAdd(address _contAdd) external;
  function setFee(uint _feeMul) external;
  function setDeployAmnt(uint _deplyAmnt) external;
  function setMrktNFTAdd(address _nft) external;
  function setRwdsAdd(address _rewards) external;
  function setTokenAdd(address _toke) external;
  function setRoleAdd(address _role) external;
  function setNFTFactoryAdd(address _nftFactory) external;
  function setNFT1155FactoryAdd(address _nftFactory) external;
  function setNewRedemption(uint amount, address _toke) external;
  function setRedemptionToken(uint64 _redeemAmount, address _contract) external;
}
interface RoleProvider {
  function setControlAdd(address _contAdd) external;
  function hasTheRole(bytes32 role, address _address) external returns(bool);
  function grantRole(bytes32 role, address _address) external;
  function revokeRole(bytes32 role, address account) external;
}
interface Rewards {
  function setControlAdd(address _contAdd) external;
  function setAccountRcv(address _recvr) external;
}

contract OwnerProxy is ReentrancyGuard {
  /*~~~>
    State Addres Variables
  <~~~*/
  address public marketplaceAdd;
  address public nftAdd;
  address public marketMintAdd;
  address public collectionsAdd;
  address public offersAdd;
  address public tradesAdd;
  address public bidsAdd;
  address public rewardsAdd;
  address public roleAdd;
  address public controlAdd;
  address public erc721FactoryAdd;
  address public erc1155FactoryAdd;

  //*~~~> Roles for designated accessibility
  bytes32 public constant PROXY_ROLE = keccak256("PROXY_ROLE"); 
  
  modifier hasAdmin(){
    require(RoleProvider(roleAdd).hasTheRole(PROXY_ROLE, msg.sender), "DOES NOT HAVE ADMIN ROLE");
    _;
  }

  constructor(address _role){
    roleAdd = _role;
  }
  /// @notice
  /*~~~>
    For setting fees on Bids, Offers, MarketMint and Marketplace
  <~~~*/
  function setFees(uint _fee) hasAdmin public returns(bool){
    Offers(offersAdd).setFee(_fee);
    Bids(bidsAdd).setFee(_fee);
    MarketMint(marketMintAdd).setFee(_fee);
    Marketplace(marketplaceAdd).setFee(_fee);
    return true;
  }

  ///@notice
  /*~~~>
    For setting the state address variables
  <~~~*/
  function addressInit(address _mrktAdd, address _nft, address _mintAdd, address _collAdd, address _offAdd, address _tradAdd, address _bidsAdd, address _rwdsAdd, address _erc721, address _erc1155) public nonReentrant hasAdmin returns(bool){
    marketplaceAdd = _mrktAdd;
    nftAdd = _nft;
    marketMintAdd = _mintAdd;
    collectionsAdd = _collAdd;
    offersAdd = _offAdd;
    tradesAdd = _tradAdd;
    bidsAdd = _bidsAdd;
    rewardsAdd = _rwdsAdd;
    erc721FactoryAdd = _erc721;
    erc1155FactoryAdd = _erc1155;
    return true;
  }
  function setControlAdd() public nonReentrant hasAdmin returns(bool){
    Bids(bidsAdd).setControlAdd(address(this));
    Offers(offersAdd).setControlAdd(address(this));
    MarketMint(marketMintAdd).setControlAdd(address(this));
    Marketplace(marketplaceAdd).setControlAdd(address(this));
    Collections(collectionsAdd).setControlAdd(address(this));
    Trades(tradesAdd).setControlAdd(address(this));
    Rewards(rewardsAdd).setControlAdd(address(this));
    RoleProvider(roleAdd).setControlAdd(address(this));
    return true;
  }
  function setMarketAdd(address _mrktAdd) hasAdmin public returns(bool){
    marketplaceAdd = _mrktAdd;
    Bids(bidsAdd).setMrktAdd(_mrktAdd);
    Offers(offersAdd).setMrktAdd(_mrktAdd);
    Trades(tradesAdd).setMrktAdd(_mrktAdd);
    return true;
  }
  function setNftAdd(address _nft) hasAdmin public returns(bool){
    nftAdd = _nft;
    Bids(bidsAdd).setMrktNFTAdd(_nft);
    Offers(offersAdd).setMrktNFTAdd(_nft);
    MarketMint(marketMintAdd).setMrktNFTAdd(_nft);
    Marketplace(marketplaceAdd).setMrktNFTAdd(_nft);
    return true;
  }
  function setMarketMintAdd(address _mintAdd) hasAdmin public returns(bool){
    marketMintAdd = _mintAdd;
    Bids(bidsAdd).setMarketMintAdd(_mintAdd);
    Offers(offersAdd).setMarketMintAdd(_mintAdd);
    Trades(tradesAdd).setMarketMintAdd(_mintAdd);
    Marketplace(marketplaceAdd).setMarketMintAdd(_mintAdd);
    return true;
  }
   function setCollectionsAdd(address _collAdd) hasAdmin public returns(bool){
    collectionsAdd = _collAdd;
    Bids(bidsAdd).setCollAdd(_collAdd);
    Marketplace(marketplaceAdd).setCollAdd(_collAdd);
    Offers(offersAdd).setCollAdd(_collAdd);
    Trades(tradesAdd).setCollAdd(_collAdd);
    return true;
  }
  function setOffersAdd(address _offAdd) hasAdmin public returns(bool){
    offersAdd = _offAdd;
    Marketplace(marketplaceAdd).setOffersAdd(_offAdd);
    Trades(tradesAdd).setOffersAdd(_offAdd);
    Bids(bidsAdd).setOffersAdd(_offAdd);
    return true;
  }
  function setTradesAdd(address _tradAdd) hasAdmin public returns(bool){
    tradesAdd = _tradAdd;
    Marketplace(marketplaceAdd).setTradesAdd(_tradAdd);
    Offers(offersAdd).setTradesAdd(_tradAdd);
    Bids(bidsAdd).setTradesAdd(_tradAdd);
    return true;
  }
  function setBidsAdd(address _bidsAdd) hasAdmin public returns(bool){
    bidsAdd = _bidsAdd;
    Offers(offersAdd).setBidAdd(_bidsAdd);
    Marketplace(marketplaceAdd).setBidAdd(_bidsAdd);
    Trades(tradesAdd).setBidAdd(_bidsAdd);
    return true;
  }
  function setRwdsAdd(address _rwdsAdd) hasAdmin public returns(bool){
    rewardsAdd = _rwdsAdd;
    Bids(bidsAdd).setRwdsAdd(_rwdsAdd);
    Offers(offersAdd).setRwdsAdd(_rwdsAdd);
    Marketplace(marketplaceAdd).setRwdsAdd(_rwdsAdd);
    MarketMint(marketMintAdd).setRwdsAdd(_rwdsAdd);
    return true;
  }
  function setRoleAdd(address _role) public hasAdmin returns(bool){
    roleAdd = _role;
    Bids(bidsAdd).setRoleAdd(_role);
    Offers(offersAdd).setRoleAdd(_role);
    MarketMint(marketMintAdd).setRoleAdd(_role);
    Marketplace(marketplaceAdd).setRoleAdd(_role);
    Collections(collectionsAdd).setRoleAdd(_role);
    Trades(tradesAdd).setRoleAdd(_role);
    return true;
  }
  function setFactoryAdd(address _erc721) public hasAdmin returns(bool){
    erc721FactoryAdd = _erc721;
    MarketMint(marketMintAdd).setNFTFactoryAdd(_erc721);
    return true;
  }
  function set1155FactoryAdd(address _erc1155) public hasAdmin returns(bool){
    erc1155FactoryAdd = _erc1155;
    MarketMint(marketMintAdd).setNFT1155FactoryAdd(_erc1155);
    return true;
  }

  ///@notice
  /*~~~>
    For setting the roles in the role provider contract
  <~~~*/
  function setProxyRoles(bytes32[] calldata role, address[] calldata account) hasAdmin public returns(bool){
    for (uint i; i<account.length; i++){
      RoleProvider(roleAdd).grantRole(role[i], account[i]);
    }
    return true;
  }
  function setProxyRole(bytes32 role, address account) hasAdmin public returns(bool){
    RoleProvider(roleAdd).grantRole(role, account);
    return true;
  }
  function revokeProxyRole(bytes32 role, address account) hasAdmin public returns(bool){
    RoleProvider(roleAdd).revokeRole(role, account);
    return true;
  }

  ///@notice
  /*~~~>
    For setting the DAO address to withdraw rewards
  <~~~*/
  function setRewardsAccountRcv(address _recvr) hasAdmin public returns(bool){
    Rewards(rewardsAdd).setAccountRcv(_recvr);
    return true;
  }

  ///@notice
  /*~~~>
    For controlling the Collection contract
  <~~~*/
  function restrictMarketCollection(
  string[] calldata name,
  address[] calldata nftContract 
  ) hasAdmin public returns(bool){
    Collections(collectionsAdd).restrictMarketCollection(name, nftContract);
    return true;
  }
  function editMarketCollection(bool[] calldata isNotTradable, string[] calldata name, address[] calldata nftContract, uint[] calldata collectionId) hasAdmin public returns(bool){
    Collections(collectionsAdd).editMarketCollection(isNotTradable, name, nftContract, collectionId);
    return true;
  }

  ///@notice
  /*~~~>
  For controlling MarketMint contract
  <~~~*/
  function setNewMintRedemption(uint amount, address _toke) hasAdmin public returns(bool){
    MarketMint(marketMintAdd).setNewRedemption(amount, _toke);
    return true;
  }
  function setMintRedemptionToken(uint64 _redeemAmount, address _contract) hasAdmin public returns(bool){
    MarketMint(marketMintAdd).setRedemptionToken(_redeemAmount, _contract);
    return true;
  }
  function setMintDeployAmnt(uint dplyAmnt) hasAdmin public returns(bool){
    MarketMint(marketMintAdd).setDeployAmnt(dplyAmnt);
    return true;
  }
  function setMintNftFactoryAdd(address factory) hasAdmin public returns(bool) {
    MarketMint(marketMintAdd).setNFTFactoryAdd(factory);
    return true;
  }
  function setMintNft1155FactoryAdd(address _1155factory) hasAdmin public returns(bool) {
    MarketMint(marketMintAdd).setNFT1155FactoryAdd(_1155factory);
    return true;
  }

  /// @notice
  /*~~~>
    For controlling the NFT contract accessibility roles after initial deployment
  <~~~*/
  function grantNFTRoles(bytes32 role, address account) hasAdmin public returns(bool) {
    NFT(nftAdd).grantRole(role, account);
    return true;
  }
  function revokeNFTRoles(bytes32 role, address account) hasAdmin public returns(bool) {
    NFT(nftAdd).revokeRole(role, account);
    return true;
  }

  /*~~~>
  Fallback functions
  <~~~*/
  event Received(address, uint);
  receive() external payable {
      emit Received(msg.sender, msg.value);
  }

  ///@notice
  //*~~~> Withdraw function for any stuck ETH sent
  function withdrawAmountFromContract(address _add) hasAdmin external {
      payable(_add).transfer(address(this).balance);
   }
}