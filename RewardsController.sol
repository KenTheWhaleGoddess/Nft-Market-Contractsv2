//*~~~> SPDX-License-Identifier: MIT OR Apache-2.0
/*~~~>
    Thank you Phunks, your inspiration and phriendship meant the world to me and helped me through hard times.
      Never stop phighting, never surrender, always stand up for what is right and make the best of all situations towards all people.
      Phunks are phreedom phighters!
        "When the power of love overcomes the love of power the world will know peace." - Jimi Hendrix <3

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(((((((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(((((((((((((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((((((((((((((((((((((@@@@@##############################%%%%%@@@@@((((((((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((((((((((((((((((((((@@@@@##############################%%%%%@@@@@((((((((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((@@@@@########################################%%%%%@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((@@@@@########################################%%%%%@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@###############@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@###############@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((@@@@@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@##########@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((@@@@@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@##########@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@/////////////////////////////////////////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@/////////////////////////////////////////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@#PHUNKYJON///////////////#PHUNKYJON//////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@#PHUNKYJON///////////////#PHUNKYJON//////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@/////@EYES////////////////////@EYES///////////////@@@@@((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@/////@EYES////////////////////@EYES///////////////EAR@@((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@//////////////////////////////////////////////////EAR@@((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@//////////////////////////////////////////////////EAR@@((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@/////////////////////////////////////////////@@@@@@@@@@((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@/////////////////////////////////////////////@@@@@@@@@@((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@//////////NOSE@NOSE@////////////////////#####@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((SMOKE((((((((((@@@@@//////////NOSE@NOSE@////////////////////#####@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((@@@@@#####//////////////////////////////##########@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((@@@@@#####//////////////////////////////##########@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((@SPLIFF@SPLIFF@SPLIFF@SPLIFF@@###################################@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((@SPLIFF@SPLIFF@SPLIFF@SPLIFF@@###################################@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((EMBER(((((,,,,,,,,,,,,,,,,,,,,,,,,,@@@@@MOUTH&&&&&####################@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((EMBER(((((,,,,,,,,,,,,,,,,,,,,,,,,,@@@@@MOUTH&&&&&####################@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((@SPLIFF@SPLIFF@SPLIFF@SPLIFF@@##############################/////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((@SPLIFF@SPLIFF@SPLIFF@SPLIFF@@##############################/////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((((((((((((((((((((((@@@@@##############################//////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%(((((((((((((((((((((((((((((((((((@@@@@##############################//////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@///////////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@///////////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((@@@@@///////////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((@@@@@///////////////@@@@@(((((((((((((((((((((((((%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@///////////////@@@@@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@///////////////@@@@@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

 <~~~*/
pragma solidity  >=0.8.0 <0.9.0;

import "@openzeppelin/contracts/security/ReentrancyGuard.sol";
import "@openzeppelin/contracts/security/Pausable.sol";

///@notice
/*~~~>
Interface declarations for upgradable contracts accessibility
<~~~*/
interface Marketplace {
  function setRoleAdd(address _role) external;
  function setFee(uint _fee) external;
}
interface NFT {
  function grantRole(bytes32 role, address account) external;
  function revokeRole(bytes32 role, address account) external;
}
interface Offers {
  function setRoleAdd(address _role) external;
  function setFee(uint _fee) external;
}
interface Collections {
  function setControlAdd(address _contAdd) external;
  function setRoleAdd(address _role) external;
  function restrictMarketCollection(string[] calldata name, address[] calldata nftContract) external;
  function editMarketCollection(bool[] calldata isNotTradable, string[] calldata name,address[] calldata nftContract, uint[] calldata collectionId) external;
}
interface Bids {
  function setRoleAdd(address _role) external;
  function setFee(uint _fee) external;
}
interface NFTFactory {
  function setRoleAdd(address _role) external;
}
interface MarketMint {
  function setFee(uint _feeMul) external;
  function setDeployAmnt(uint _deplyAmnt) external;
  function setRoleAdd(address _role) external;
  function setNewRedemption(uint amount, address _toke) external;
  function setRedemptionToken(uint64 _redeemAmount, address _contract) external;
}
interface RoleProvider {
  function fetchAddress(bytes32 _var) external returns(address);
  function setMarketAdd(address _mrktAdd) external returns(bool);
  function setMarketMintAdd(address _mintAdd) external returns(bool);
  function setNftAdd(address _nftAdd) external returns(bool);
  function setCollectionsAdd(address _collAdd) external returns(bool);
  function setOffersAdd(address _offAdd) external returns(bool);
  function setTradesAdd(address _tradAdd) external returns(bool);
  function setBidsAdd(address _bidsAdd) external returns(bool);
  function setRwdsAdd(address _rwdsAdd) external returns(bool);
  function setRoleAdd(address _role) external returns(bool);
  function setOwnerProxyAdd(address _proxyAdd) external returns(bool);
  function setFactoryAdd(address _erc721) external returns(bool);
  function set1155FactoryAdd(address _erc1155) external returns(bool);
  function setPhunkyAdd(address _phunky) external returns(bool);
  function setDevSigAddress(address _sig) external returns(bool);
  function hasTheRole(bytes32 role, address _address) external returns(bool);
  function grantRole(bytes32 role, address _address) external;
  function revokeRole(bytes32 role, address account) external;
}
interface Rewards {
  function setRoleAdd(address _role) external;
  function setAccountRcv(address _recvr) external;
}

contract OwnerProxy is ReentrancyGuard, Pausable {
  /*~~~>
    State Address Variables
  <~~~*/
  //*~~~> global address variable from Role Provider contract
  bytes32 public constant REWARDS = keccak256("REWARDS");
  address rewardsAdd = RoleProvider(roleAdd).fetchAddress(REWARDS);

  bytes32 public constant COLLECTION = keccak256("COLLECTION");
  address collectionsAdd = RoleProvider(roleAdd).fetchAddress(COLLECTION);
  
  bytes32 public constant BIDS = keccak256("BIDS");
  address bidsAdd = RoleProvider(roleAdd).fetchAddress(BIDS);
  
  bytes32 public constant OFFERS = keccak256("OFFERS");
  address offersAdd = RoleProvider(roleAdd).fetchAddress(OFFERS);
  
  bytes32 public constant TRADES = keccak256("TRADES");
  address tradesAdd = RoleProvider(roleAdd).fetchAddress(TRADES);

  bytes32 public constant NFTADD = keccak256("NFT");
  address nftAdd = RoleProvider(roleAdd).fetchAddress(NFTADD);

  bytes32 public constant MINT = keccak256("MINT");
  address marketMintAdd = RoleProvider(roleAdd).fetchAddress(MINT);

  bytes32 public constant MARKET = keccak256("MARKET");
  address marketPlaceAdd = RoleProvider(roleAdd).fetchAddress(MARKET);

  bytes32 public constant PROXY = keccak256("PROXY");
  address controlAdd = RoleProvider(roleAdd).fetchAddress(PROXY);

  bytes32 public constant ERC721FACTORY = keccak256("ERC721FACTORY");
  address erc721FactoryAdd = RoleProvider(roleAdd).fetchAddress(ERC721FACTORY);

  bytes32 public constant ERC1155FACTORY = keccak256("ERC1155FACTORY");
  address erc1155FactoryAdd = RoleProvider(roleAdd).fetchAddress(ERC1155FACTORY);

  bytes32 public constant DEV = keccak256("DEV");
  address devAdd = RoleProvider(roleAdd).fetchAddress(DEV);


  address public roleAdd;

  //*~~~> Roles for designated accessibility
  bytes32 public constant PROXY_ROLE = keccak256("PROXY_ROLE"); 
  bytes32 public constant DEV_ROLE = keccak256("DEV_ROLE");
  modifier hasAdmin(){
    require(RoleProvider(roleAdd).hasTheRole(PROXY_ROLE, msg.sender), "DOES NOT HAVE ADMIN ROLE");
    _;
  }
  modifier hasDevAdmin(){
    require(RoleProvider(roleAdd).hasTheRole(DEV_ROLE, msg.sender), "DOES NOT HAVE DEV ROLE");
    _;
  }

  constructor(address _role){
    roleAdd = _role;
  }
  /// @notice
  /*~~~>
    For setting fees on Bids, Offers, MarketMint and Marketplace
  <~~~*/
  function setFees(uint _fee) hasAdmin public returns(bool){
    Offers(offersAdd).setFee(_fee);
    Bids(bidsAdd).setFee(_fee);
    MarketMint(marketMintAdd).setFee(_fee);
    Marketplace(marketPlaceAdd).setFee(_fee);
    return true;
  }

  ///@notice
  /*~~~>
    For setting the state address variables
  <~~~*/
  function addressInit(address _mrktAdd, address _nft, address _mintAdd, address _collAdd, address _offAdd, address _tradAdd, address _bidsAdd, address _rwdsAdd, address _erc721, address _erc1155) public nonReentrant hasAdmin returns(bool){
    marketPlaceAdd = _mrktAdd;
    nftAdd = _nft;
    marketMintAdd = _mintAdd;
    collectionsAdd = _collAdd;
    offersAdd = _offAdd;
    tradesAdd = _tradAdd;
    bidsAdd = _bidsAdd;
    rewardsAdd = _rwdsAdd;
    erc721FactoryAdd = _erc721;
    erc1155FactoryAdd = _erc1155;
    return true;
  }
  function setControlAdd() public nonReentrant hasAdmin returns(bool){
    return true;
  }
  function setMarketAdd(address _mrktAdd) hasAdmin public returns(bool){
    marketPlaceAdd = _mrktAdd;
    RoleProvider(roleAdd).setMarketAdd(_mrktAdd);
    return true;
  }
  function setNftAdd(address _nft) hasAdmin public returns(bool){
    nftAdd = _nft;
    RoleProvider(roleAdd).setNftAdd(_nft);
    return true;
  }
  function setMarketMintAdd(address _mintAdd) hasAdmin public returns(bool){
    marketMintAdd = _mintAdd;
    RoleProvider(roleAdd).setMarketMintAdd(_mintAdd);
    return true;
  }
   function setCollectionsAdd(address _collAdd) hasAdmin public returns(bool){
    collectionsAdd = _collAdd;
    RoleProvider(roleAdd).setCollectionsAdd(_collAdd);
    return true;
  }
  function setOffersAdd(address _offAdd) hasAdmin public returns(bool){
    offersAdd = _offAdd;
    RoleProvider(roleAdd).setOffersAdd(_offAdd);
    return true;
  }
  function setTradesAdd(address _tradAdd) hasAdmin public returns(bool){
    tradesAdd = _tradAdd;
    RoleProvider(roleAdd).setTradesAdd(_tradAdd);
    return true;
  }
  function setBidsAdd(address _bidsAdd) hasAdmin public returns(bool){
    bidsAdd = _bidsAdd;
    RoleProvider(roleAdd).setBidsAdd(_bidsAdd);
    return true;
  }
  function setRwdsAdd(address _rwdsAdd) hasAdmin public returns(bool){
    rewardsAdd = _rwdsAdd;
    RoleProvider(roleAdd).setRwdsAdd(_rwdsAdd);
    return true;
  }
  function setRoleAdd(address _role) public hasAdmin returns(bool){
    roleAdd = _role;
    return true;
  }
  function setFactoryAdd(address _erc721) public hasAdmin returns(bool){
    erc721FactoryAdd = _erc721;
    RoleProvider(roleAdd).setFactoryAdd(_erc721);
    return true;
  }
  function set1155FactoryAdd(address _erc1155) public hasAdmin returns(bool){
    erc1155FactoryAdd = _erc1155;
    RoleProvider(roleAdd).set1155FactoryAdd(_erc1155);
    return true;
  }
  function setDevAdd(address _devAdd) public hasDevAdmin returns(bool){
    devAdd = _devAdd;
    RoleProvider(roleAdd).setDevSigAddress(_devAdd);
    return true;
  }

  ///@notice
  /*~~~>
    For setting the roles in the role provider contract
  <~~~*/
  function setProxyRoles(bytes32[] calldata role, address[] calldata account) hasAdmin public returns(bool){
    for (uint i; i<account.length; i++){
      RoleProvider(roleAdd).grantRole(role[i], account[i]);
    }
    return true;
  }
  function setProxyRole(bytes32 role, address account) hasAdmin public returns(bool){
    RoleProvider(roleAdd).grantRole(role, account);
    return true;
  }
  function revokeProxyRole(bytes32 role, address account) hasAdmin public returns(bool){
    RoleProvider(roleAdd).revokeRole(role, account);
    return true;
  }

  ///@notice
  /*~~~>
    For setting the DAO address to withdraw rewards
  <~~~*/
  function setRewardsAccountRcv(address _recvr) hasAdmin public returns(bool){
    Rewards(rewardsAdd).setAccountRcv(_recvr);
    return true;
  }

  ///@notice
  /*~~~>
    For controlling the Collection contract
  <~~~*/
  function restrictMarketCollection(
  string[] calldata name,
  address[] calldata nftContract 
  ) hasAdmin public returns(bool){
    Collections(collectionsAdd).restrictMarketCollection(name, nftContract);
    return true;
  }

  function editMarketCollection(bool[] calldata isNotTradable, string[] calldata name, address[] calldata nftContract, uint[] calldata collectionId) hasAdmin public returns(bool){
    Collections(collectionsAdd).editMarketCollection(isNotTradable, name, nftContract, collectionId);
    return true;
  }

  ///@notice
  /*~~~>
  For controlling MarketMint contract
  <~~~*/
  function setNewMintRedemption(uint amount, address _toke) hasAdmin public returns(bool){
    MarketMint(marketMintAdd).setNewRedemption(amount, _toke);
    return true;
  }
  function setMintRedemptionToken(uint64 _redeemAmount, address _contract) hasAdmin public returns(bool){
    MarketMint(marketMintAdd).setRedemptionToken(_redeemAmount, _contract);
    return true;
  }
  function setMintDeployAmnt(uint dplyAmnt) hasAdmin public returns(bool){
    MarketMint(marketMintAdd).setDeployAmnt(dplyAmnt);
    return true;
  }

  /// @notice
  /*~~~>
    For controlling the NFT contract accessibility roles after initial deployment
  <~~~*/
  function grantNFTRoles(bytes32 role, address account) hasAdmin public returns(bool) {
    NFT(nftAdd).grantRole(role, account);
    return true;
  }
  function revokeNFTRoles(bytes32 role, address account) hasAdmin public returns(bool) {
    NFT(nftAdd).revokeRole(role, account);
    return true;
  }

  ///@notice DEV operations for emergency functions
  function pause() public hasDevAdmin {
      _pause();
  }
  function unpause() public hasDevAdmin {
      _unpause();
  }

  /*~~~>
  Fallback functions
  <~~~*/
  /*~~~> External ETH transfer forwarded to role provider contract <~~~*/
  event FundsForwarded(uint value, address _from, address _to);
  receive() external payable {
    payable(roleAdd).transfer(msg.value);
      emit FundsForwarded(msg.value, msg.sender, roleAdd);
  }
  ///@notice
  //*~~~> Withdraw function for any stuck ETH sent
  function withdrawAmountFromContract(address _add) hasAdmin external {
      payable(_add).transfer(address(this).balance);
   }
}
